┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                               ARCHITECTURE DU SYSTÈME RAG ONTOLOGIQUE                                   │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                                             │
                       ┌───────────────────────────────────────────────────────────────────┐
                       │                    PHASE 1: PRÉPARATION DES DONNÉES               │
                       └───────────────────────────────────────────────────────────────────┘
                                                             │
           ┌─────────────────────────────┬──────────────────────────────┬─────────────────────────────┐
           ▼                             ▼                              ▼                             ▼
┌───────────────────────┐    ┌───────────────────────┐    ┌───────────────────────┐    ┌───────────────────────┐
│  Traitement Documents │    │  Analyse Ontologique  │    │ Création d'Embeddings │    │     Construction      │
│                       │    │                       │    │                       │    │  Réseaux de Hopfield  │
│ • Chunking intelligent│    │ • Parsing ontologie   │    │ • Embeddings chunks   │    │                       │
│ • Extraction metadata │    │ • Structure hiérarch. │    │ • Embeddings concepts │    │ • Un réseau par niveau│
│ • Indexation textes   │    │ • Analyse axiomes     │    │ • Embeddings domaines │    │ • Stockage patterns   │
└───────────────────────┘    └───────────────────────┘    └───────────────────────┘    └───────────────────────┘
                                                             │
                       ┌───────────────────────────────────────────────────────────────────┐
                       │                    PHASE 2: TRAITEMENT DES REQUÊTES               │
                       └───────────────────────────────────────────────────────────────────┘
                                                             │
┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                   PROCESSUS DE RECHERCHE ONTOLOGIQUE                                                  │
│                                                                                                                       │
│                         ┌─────────────────────────────────────────────────────────────┐                               │
│                         │                    REQUÊTE UTILISATEUR                      │                               │
│                         └─────────────────────────────────────────────────────────────┘                               │
│                                                    │                                                                  │
│                                                    ▼                                                                  │
│                         ┌────────────────────────────────────────────────────────────┐                                │
│                         │               DÉTECTION AUTOMATIQUE DE CONCEPTS            │                                │
│                         │                                                            │                                │
│                         │  ┌──────────────────────┐        ┌─────────────────────┐   │                                │
│                         │  │   Approche Bottom-up │        │  Approche Top-down  │   │                                │
│                         │  │                      │        │                     │   │                                │
│                         │  │• Niveau 6 → Niveau 1 │        │• Classification     │   │                                │
│                         │  │• Concepts spécifiques│        │  hiérarchique       │   │                                │
│                         │  │  vers généraux       │        │  directe            │   │                                │
│                         │  └──────────────────────┘        └─────────────────────┘   │                                │
│                         │                 │                          │               │                                │
│                         │                 └──────────┬───────────────┘               │                                │
│                         │                            ▼                               │                                │
│                         │              ┌─────────────────────────┐                   │                                │
│                         │              │  Fusion intelligente    │                   │                                │
│                         │              │  des concepts détectés  │                   │                                │
│                         │              └─────────────────────────┘                   │                                │
│                         └─────────────────────────┬──────────────────────────────────┘                                │
│                                                   │                                                                   │
│                                                   ▼                                                                   │
│                        ┌──────────────────────────────────────────────────────────────┐                               │
│                        │             RECHERCHE CONTEXTUELLE PAR CONCEPTS              │                               │
│                        │                                                              │                               │
│                        │  • Recherche pour chaque concept détecté                     │                               │
│                        │  • Inclusion des sous-concepts                               │                               │
│                        │  • Identification des documents pertinents                   │                               │
│                        │  • Pondération: similarité requête + pertinence concept      │                               │
│                        │  • Score combiné = 0.7*similarité + 0.3*confiance_concept    │                               │
│                        └──────────────────────────┬───────────────────────────────────┘                               │
│                                                   │                                                                   │
│                                                   ▼                                                                   │
│                        ┌──────────────────────────────────────────────────────────────┐                               │
│                        │              GÉNÉRATION DE RÉPONSE CONTEXTUELLE              │                               │
│                        │                                                              │                               │
│                        │  • Création d'un prompt enrichi avec hiérarchies complètes   │                               │
│                        │  • Inclusion des relations sémantiques (optionnel)           │                               │
│                        │  • Fourniture des passages les plus pertinents au LLM        │                               │
│                        │  • Contextualisation de la réponse                           │                               │
│                        └──────────────────────────────────────────────────────────────┘                               │
└───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘


Architecture détaillée en couches
1- Couche de connaissances
┌───────────────────────────────────────────────┐
│             COUCHE DE CONNAISSANCES           │
├───────────────────┬───────────────────────────┤
│                   │                           │
│  DOCUMENTS        │         ONTOLOGIE         │
│                   │                           │
│ • Textes source   │  • Concepts               │
│ • Chunks indexés  │  • Relations hiérarchiques│
│ • Métadonnées     │  • Relations sémantiques  │
│                   │  • Axiomes                │
└───────────────────┴───────────────────────────┘

2- Couche d'embeddings et réseaux de Hopfield
┌─────────────────────────────────────────────────────────────────────────────────┐
│                      EMBEDDINGS ET RÉSEAUX DE HOPFIELD                          │
├─────────────────────┬─────────────────────────────┬─────────────────────────────┤
│                     │                             │                             │
│ EMBEDDINGS          │  RÉSEAUX HOPFIELD DOMAINES  │  RÉSEAUX HOPFIELD CONCEPTS  │
│                     │                             │                             │
│ • Chunks textuels   │  • Un réseau par niveau     │  • Un réseau par niveau     │
│ • Concepts          │  • Niveau 1: Grands domaines│  • Niveaux 1-6: Hiérarchie  │
│ • Domaines          │  • Niveaux 2+: Sous-domaines│    conceptuelle complète    │
│ • Requêtes          │                             │                             │
└─────────────────────┴─────────────────────────────┴─────────────────────────────┘

3- Détection de concepts (Smart Concept Detection)
┌───────────────────────────────────────────────────────────────────────────────────────┐
│                   DÉTECTION INTELLIGENTE DE CONCEPTS (REQUÊTE)                        │
│                                                                                       │
│  ┌───────────────────────────────────────────┐    ┌───────────────────────────────┐   │
│  │           APPROCHE BOTTOM-UP              │    │         APPROCHE TOP-DOWN     │   │
│  │                                           │    │                               │   │
│  │          Requête Utilisateur              │    │        Requête Utilisateur    │   │
│  │                  │                        │    │               │               │   │
│  │                  ▼                        │    │               ▼               │   │
│  │  ┌─────────────────────────────┐          │    │   ┌───────────────────────┐   │   │
│  │  │Évaluation Niveau 6 (profond)│          │    │   │    Embedding Requête  │   │   │
│  │  └───────────────┬─────────────┘          │    │   └───────────┬───────────┘   │   │
│  │                  │                        │    │               │               │   │
│  │                  ▼                        │    │               ▼               │   │
│  │  ┌─────────────────────────────┐          │    │   ┌───────────────────────┐   │   │
│  │  │    Évaluation Niveau 5      │          │    │   │Classification complète│   │   │
│  │  └───────────────┬─────────────┘          │    │   │     hiérarchique      │   │   │
│  │                  │                        │    │   └───────────┬───────────┘   │   │
│  │                  ▼                        │    │               │               │   │
│  │  ┌─────────────────────────────┐          │    │               │               │   │
│  │  │        ...                  │          │    │               │               │   │
│  │  └───────────────┬─────────────┘          │    │               │               │   │
│  │                  │                        │    │               │               │   │
│  │                  ▼                        │    │               │               │   │
│  │  ┌─────────────────────────────┐          │    │               │               │   │
│  │  │ Évaluation Niveau 1 (racine)│          │    │               │               │   │
│  │  └───────────────┬─────────────┘          │    │               │               │   │
│  │                  │                        │    │               │               │   │
│  └──────────────────┼────────────────────────┘    └───────────────┼───────────────┘   │
│                     │                                             │                   │
│                     └──────────────────┬────────────────────────┬─┘                   │
│                                        │                        │                     │
│                                        ▼                        ▼                     │
│                             ┌────────────────────┐   ┌────────────────────┐           │
│                             │ Concepts détectés  │   │ Concepts détectés  │           │
│                             │   Bottom-up        │   │     Top-down       │           │
│                             └──────────┬─────────┘   └──────────┬─────────┘           │
│                                        │                        │                     │
│                                        └────────────┬───────────┘                     │
│                                                     │                                 │
│                                                     ▼                                 │
│                                         ┌─────────────────────────┐                   │
│                                         │     Fusion concepts     │                   │
│                                         │  (priorisation, scores) │                   │
│                                         └─────────────────────────┘                   │
└───────────────────────────────────────────────────────────────────────────────────────┘

4- Processus de recherche et génération
┌────────────────────────────────────────────────────────────────────────────────────────┐
│                  RECHERCHE CONTEXTUELLE ET GÉNÉRATION DE RÉPONSE                       │
│                                                                                        │
│  ┌────────────────────────────────────────────────────────────────────────────────┐    │
│  │                                                                                │    │
│  │  ┌──────────────────┐    ┌──────────────────┐    ┌────────────────────────┐    │    │
│  │  │ Concept 1 détecté│    │ Concept 2 détecté│    │   Concept N détecté    │    │    │
│  │  │  (avec chaîne    │    │  (avec chaîne    │    │    (avec chaîne        │    │    │
│  │  │  hiérarchique)   │    │  hiérarchique)   │    │    hiérarchique)       │    │    │
│  │  └────────┬─────────┘    └────────┬─────────┘    └───────────┬────────────┘    │    │
│  │           │                       │                          │                 │    │
│  │           ▼                       ▼                          ▼                 │    │
│  │  ┌────────────────┐     ┌────────────────┐         ┌────────────────┐          │    │
│  │  │  Recherche     │     │  Recherche     │         │  Recherche     │          │    │
│  │  │ par concept 1  │     │ par concept 2  │   ...   │ par concept N  │          │    │
│  │  │ (+ sous-concep)│     │ (+ sous-concep)│         │ (+ sous-concep)│          │    │
│  │  └────────┬───────┘     └────────┬───────┘         └────────┬───────┘          │    │
│  │           │                      │                          │                  │    │
│  │           └──────────────────────┼──────────────────────────┘                  │    │
│  │                                  │                                             │    │
│  │                                  ▼                                             │    │
│  │                      ┌────────────────────────────┐                            │    │
│  │                      │   Combinaison de tous les  │                            │    │
│  │                      │   passages avec scoring    │                            │    │
│  │                      │   hybride                  │                            │    │
│  │                      └─────────────┬──────────────┘                            │    │
│  │                                    │                                           │    │
│  │                                    ▼                                           │    │
│  │                      ┌────────────────────────────┐                            │    │
│  │                      │  Création prompt enrichi   │                            │    │
│  │                      │  avec hiérarchies complètes│                            │    │
│  │                      │  de concepts et relations  │                            │    │
│  │                      └─────────────┬──────────────┘                            │    │
│  │                                    │                                           │    │
│  │                                    ▼                                           │    │
│  │                      ┌────────────────────────────┐                            │    │
│  │                      │  Génération de réponse     │                            │    │
│  │                      │  contextuelle par LLM      │                            │    │
│  │                      └────────────────────────────┘                            │    │
│  └────────────────────────────────────────────────────────────────────────────────┘    │
└────────────────────────────────────────────────────────────────────────────────────────┘

